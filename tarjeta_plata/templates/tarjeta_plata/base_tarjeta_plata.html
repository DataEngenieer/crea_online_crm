{% extends 'core/base.html' %}
{% load static %}

{% block extra_css %}
    {{ block.super }}
    <style>
        /* Estilos específicos para el módulo de Tarjeta Plata */
        .tarjeta-plata-content {
            padding: 20px;
        }
        /* Estilos para el menú lateral con scroll */
        .sidebar-menu-tarjeta-plata {
            max-height: calc(100vh - 120px); /* Altura máxima menos el espacio del header */
            overflow-y: auto; /* Habilita el scroll vertical */
            scrollbar-width: thin; /* Para navegadores Firefox */
            scrollbar-color: rgba(255, 255, 255, 0.2) transparent; /* Color del scroll */
        }
        /* Estilos para el scroll en navegadores WebKit (Chrome, Safari, etc) */
        .sidebar-menu-tarjeta-plata::-webkit-scrollbar {
            width: 6px;
        }
        .sidebar-menu-tarjeta-plata::-webkit-scrollbar-track {
            background: transparent;
        }
        .sidebar-menu-tarjeta-plata::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
        .sidebar-menu-tarjeta-plata::-webkit-scrollbar-thumb:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        /* Asegurar que el menú ocupe todo el alto disponible */
        .sidebar-menu-tarjeta-plata {
            position: sticky;
            top: 60px; /* Ajustar según la altura del header */
            bottom: 0;
        }
        .menu-section {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.8rem;
            text-transform: uppercase;
            margin: 1rem 0 0.5rem;
            padding: 0.5rem 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            background-color: #343a40; /* Color de fondo del menú */
            z-index: 1;
        }
        .badge-notification {
            font-size: 0.7rem;
            padding: 0.25rem 0.5rem;
        }
        /* Estilos específicos para el hover del menú de tarjeta plata */
        .sidebar-menu-tarjeta-plata .list-group-item-action:hover {
            background-color: rgba(255, 255, 255, 0.9) !important;
            color: #212529 !important;
            border-radius: 0.375rem;
            margin: 0.125rem 0.5rem;
        }
        .sidebar-menu-tarjeta-plata .dropdown-item:hover {
            background-color: rgba(255, 255, 255, 0.9) !important;
            color: #212529 !important;
        }
        /* Colores específicos para Tarjeta Plata */
        .tarjeta-plata-primary {
            background: linear-gradient(135deg, #c0392b, #e74c3c);
            color: white;
        }
        .tarjeta-plata-secondary {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            color: white;
        }
        .card-tarjeta-plata {
            border-left: 4px solid #e74c3c;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
{% endblock %}

{% block sidebar_menu %}
    <!-- Menú lateral de navegación para el módulo Tarjeta Plata -->
    <nav class="list-group list-group-flush sidebar-menu-tarjeta-plata">
        <!-- Dashboard -->
        {% if user.is_superuser or user.groups.all|length > 0 %}
        <a href="{% url 'tarjeta_plata:dashboard' %}"
           class="list-group-item list-group-item-action bg-transparent text-white border-0 {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
            <i class="bi bi-speedometer2 me-2"></i> Dashboard
        </a>
        {% endif %}
        
        <!-- Ventas -->
        <span class="menu-section">Ventas</span>
        
        {% if user.groups.all|length > 0 %}
        <a href="{% url 'tarjeta_plata:lista_ventas' %}"
           class="list-group-item list-group-item-action bg-transparent text-white border-0 {% if request.resolver_match.url_name == 'lista_ventas' %}active{% endif %}">
            <i class="bi bi-list-ul me-2"></i> 
            {% if user.groups.filter.name == 'asesor' %}Mis Ventas{% else %}Lista de Ventas{% endif %}
        </a>
        
        <a href="{% url 'tarjeta_plata:crear_venta' %}"
           class="list-group-item list-group-item-action bg-transparent text-white border-0 {% if request.resolver_match.url_name == 'crear_venta' %}active{% endif %}">
            <i class="bi bi-credit-card me-2"></i> Nueva Venta
        </a>
        {% endif %}
        
        <!-- Bandejas -->
        {% if user.is_superuser or 'backoffice' in user.groups.values_list.name or 'administrador' in user.groups.values_list.name %}
        <span class="menu-section">Bandejas</span>
        
        <a href="{% url 'tarjeta_plata:bandeja_nuevas' %}"
           class="list-group-item list-group-item-action bg-transparent text-white border-0 {% if request.resolver_match.url_name == 'bandeja_nuevas' %}active{% endif %}">
            <i class="bi bi-hourglass-split me-2"></i> Nuevas
            <span class="badge bg-warning float-end" id="badge-nuevas">0</span>
        </a>
        
        <a href="{% url 'tarjeta_plata:bandeja_aceptadas' %}"
           class="list-group-item list-group-item-action bg-transparent text-white border-0 {% if request.resolver_match.url_name == 'bandeja_aceptadas' %}active{% endif %}">
            <i class="bi bi-check-circle me-2"></i> Aceptadas
        </a>
        
        <a href="{% url 'tarjeta_plata:bandeja_rechazadas' %}"
           class="list-group-item list-group-item-action bg-transparent text-white border-0 {% if request.resolver_match.url_name == 'bandeja_rechazadas' %}active{% endif %}">
            <i class="bi bi-x-circle me-2"></i> Rechazadas
        </a>
        {% endif %}
        
        <!-- Clientes -->
        <span class="menu-section">Clientes</span>
        
        <a href="{% url 'tarjeta_plata:lista_clientes' %}"
           class="list-group-item list-group-item-action bg-transparent text-white border-0 {% if request.resolver_match.url_name == 'lista_clientes' %}active{% endif %}">
            <i class="bi bi-people me-2"></i> Lista de Clientes
        </a>
        
        <a href="{% url 'tarjeta_plata:crear_cliente' %}"
           class="list-group-item list-group-item-action bg-transparent text-white border-0 {% if request.resolver_match.url_name == 'crear_cliente' %}active{% endif %}">
            <i class="bi bi-person-plus me-2"></i> Nuevo Cliente
        </a>
        
        <a href="{% url 'tarjeta_plata:carga_masiva_clientes' %}"
           class="list-group-item list-group-item-action bg-transparent text-white border-0 {% if request.resolver_match.url_name == 'carga_masiva_clientes' %}active{% endif %}">
            <i class="bi bi-upload me-2"></i> Carga Masiva
        </a>
        
        <!-- Administración -->
        {% if user.is_superuser or 'administrador' in user.groups.values_list.name %}
        <span class="menu-section">Administración</span>
        
        <a href="{% url 'tarjeta_plata:reportes' %}"
           class="list-group-item list-group-item-action bg-transparent text-white border-0 {% if request.resolver_match.url_name == 'reportes' %}active{% endif %}">
            <i class="bi bi-file-earmark-bar-graph me-2"></i> Reportes
        </a>
        
        <a href="{% url 'tarjeta_plata:exportar_ventas' %}"
           class="list-group-item list-group-item-action bg-transparent text-white border-0">
            <i class="bi bi-download me-2"></i> Exportar Ventas
        </a>
        
        <a href="{% url 'tarjeta_plata:exportar_clientes' %}"
           class="list-group-item list-group-item-action bg-transparent text-white border-0">
            <i class="bi bi-download me-2"></i> Exportar Clientes
        </a>
        {% endif %}
    </nav>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="tarjeta-plata-content">
        <!-- Los mensajes se muestran como toasts desde la plantilla base -->
        
        {% block contenido_tarjeta_plata %}
        <!-- Contenido específico de cada página -->
        {% endblock %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script>
    // Auto-refresh de badges eliminado para reducir tráfico innecesario al servidor
    // Los badges se actualizan solo cuando el usuario navega entre páginas
    document.addEventListener('DOMContentLoaded', function() {
        // Funcionalidad básica de la página sin actualizaciones automáticas
    });
</script>
{% endblock %}